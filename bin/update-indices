#!/usr/bin/env python

import os

from lxml.html import tostring

from simple_cloud_site.files import find_recent_pages
from simple_cloud_site.html import parse_html


def main():
    source_dir = os.path.realpath(os.curdir)

    recent_posts = find_recent_pages(source_dir, count=4)

    # TODO: read template name from a config file
    template = parse_html("_templates/index.html")

    # Find post list placeholder
    # clone
    # populate

    # sanity check placeholders

    with open('index.html', 'wb') as f:
        # FIXME: non-uglifying lxml pretty-printerâ€¦
        f.write(tostring(template, encoding="utf-8", method="html", pretty_print=True))

    # TODO: Repeat for sub directories?

if __name__ == "__main__":
    main()
